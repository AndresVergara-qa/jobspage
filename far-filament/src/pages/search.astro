---
import Layout from '../layouts/Layout.astro';
import SearchBar from '../components/SearchBar.astro';
import FilterSidebar from '../components/FilterSidebar.astro';
import JobCard from '../components/JobCard.astro';
import EmptyState from '../components/EmptyState.astro';
import { searchJobs, fetchJobs } from '../services/jobService';

const query = Astro.url.searchParams.get('q') || '';
const jobs = query ? await searchJobs(query) : await fetchJobs();
---

<Layout title={query ? `"${query}" Jobs | JobRadar` : 'All Jobs | JobRadar'}>
  <!-- Search Header -->
  <div class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 py-6">
    <div class="section-container">
      <SearchBar placeholder="Job title, keywords..." />
    </div>
  </div>

  <!-- Main Layout -->
  <div class="section-container py-8 grid grid-cols-1 md:grid-cols-12 gap-8">
    <!-- Left Sidebar -->
    <div class="md:col-span-3">
      <FilterSidebar />
    </div>

    <!-- Main Content -->
    <section class="md:col-span-6 space-y-4">
      <div class="flex flex-col sm:flex-row sm:items-end justify-between mb-2 gap-3">
        <div>
          <h1 class="text-2xl font-bold text-slate-900 dark:text-white">
            {query ? `Results for: ${query}` : 'All Jobs'}
          </h1>
          <p class="text-slate-500 text-sm mt-1">
            Showing {jobs.length} verified listing{jobs.length !== 1 ? 's' : ''}
          </p>
        </div>
        <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400">
          <span>Sort by:</span>
          <select class="bg-transparent border-none text-primary font-semibold focus:ring-0 cursor-pointer p-0 pr-6">
            <option>Most Recent</option>
            <option>Relevance</option>
          </select>
        </div>
      </div>

      {jobs.length > 0 ? (
        <div class="space-y-4">
          {jobs.map((job) => (
            <JobCard job={job} />
          ))}
        </div>
      ) : (
        <EmptyState
          title="No jobs found"
          message={`We couldn't find any jobs matching "${query}". Try a different search.`}
        />
      )}
    </section>

    <!-- Right Sidebar -->
    <aside class="md:col-span-3 space-y-6">
      <!-- Job Alert -->
      <div class="bg-primary p-6 rounded-xl text-white shadow-primary-lg">
        <div class="flex items-center gap-2 mb-4">
          <span class="material-icons">notifications_active</span>
          <h3 class="font-bold text-lg">Job Alert</h3>
        </div>
        <p class="text-sm text-white/80 mb-4 leading-relaxed">
          Get new jobs daily matching your search in your inbox.
        </p>
        <div class="space-y-3">
          <input
            class="w-full bg-white/20 border-white/30 text-white placeholder-white/60 rounded-lg px-4 py-2.5 text-sm focus:ring-white/50 focus:border-white/50"
            placeholder="Email address"
            type="email"
          />
          <button class="w-full bg-white text-primary font-bold py-2.5 rounded-lg text-sm hover:bg-slate-100 transition-all">
            Subscribe Now
          </button>
        </div>
      </div>

      <!-- Career Tips -->
      <div class="card p-5">
        <h3 class="font-bold text-slate-900 dark:text-white uppercase text-xs tracking-wider mb-4">Career Tips</h3>
        <ul class="space-y-3">
          {[
            '5 Skills every QA Lead needs',
            'Mastering Automation Interviews',
            'Remote Work: Productivity Hacks',
          ].map((tip) => (
            <li>
              <a class="text-sm text-slate-600 dark:text-slate-400 hover:text-primary flex items-center gap-2 group" href="/blog">
                <span class="material-icons text-sm text-slate-300 group-hover:text-primary">article</span>
                {tip}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </aside>
  </div>
</Layout>
